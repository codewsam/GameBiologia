<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Perguntas - Jogo Verdadeiro ou Falso</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
  <link rel="stylesheet" href="style.css">
</head>
<body class="p-4">

  <div class="equipes-container mx-auto" style="max-width:900px;">
    <div class="equipe-atual" id="equipeAtualBox">
      <h3>Vez de: <span id="nomeEquipeAtual">-</span></h3>
    </div>

    <div id="placar" class="mb-3" style="text-align:center;">
      <strong>Placar:</strong> <span id="placarText">Equipe 1: 0 — Equipe 2: 0</span>
    </div>

    <div class="pergunta-container" id="perguntaContainer">
      <h2 id="perguntaTexto">Carregando...</h2>
  

      <div class="botoes">
        <button type="button" id="btnVerdadeiro" class="btn-resposta">Verdadeiro</button>
        <button type="button" id="btnFalso" class="btn-resposta">Falso</button>
      </div>

      <div id="feedback" class="feedback text-center" style="display:none;">
        <p id="resultadoResposta"></p>
      </div>

      <!-- Professor valida a opção -->
      <div id="areaJustificativa" style="display:none;">
        <p>Justificou certo?</p>
        <button class="btn-mini" id="justificativaSim">Sim</button>
        <button class="btn-mini" id="justificativaNao">Não</button>
      </div>

      <!-- Se NÃO, aparece o desafio -->
      <div id="area-desafio" style="display:none;">
        <span>Equipe adversária (<strong id="nomeAdversaria"></strong>) quer desafiar?</span>
        <div style="margin-top:10px;">
          <button class="btn-mini" id="desafioSim">Sim</button>
          <button class="btn-mini" id="desafioNao">Não</button>
        </div>
      </div>

      <!-- Justificativa (aparece quando a resposta estiver correta e pergunta tiver peso>1) -->
      <div id="areaJustificativaTexto" style="display:none; margin-top:20px;">
        <label for="justificativa">Enviar justificativa (moderador irá validar):</label>
        <textarea id="justificativa" rows="4" style="width:100%; border-radius:10px; padding:8px;"></textarea>
        <div style="text-align:center; margin-top:10px;">
          <button id="enviarJust" class="btn-continuar">Enviar justificativa</button>
        </div>
      </div>

      <!-- Controles do moderador para validar justificativa -->
      <div id="controlesModerador" style="display:none; margin-top:15px; text-align:center;">
        <p><small>Moderador: marque a justificativa</small></p>
        <button id="justOk" class="btn-mini">Justificativa correta</button>
        <button id="justBad" class="btn-mini">Justificativa incorreta</button>
      </div>

      <div style="text-align:center; margin-top:20px;">
        <button id="proxima" class="btn-continuar" style="display:none;">Próxima pergunta</button>
      </div>
    </div>

    <div id="placarFinal" class="card text-center" style="display:none; margin-top:25px; padding:22px; border-radius:14px; box-shadow:0 10px 30px rgba(0,0,0,0.06);">
      <div class="card-body">
        <h2 id="tituloFinal" style="margin-bottom:6px; color:#ef5897">Resultado Final</h2>
        <p id="subTituloFinal" class="small text-muted" style="margin-bottom:12px;">Veja o placar e reinicie para jogar novamente</p>
        <div id="placarResumo" style="margin-bottom:12px;"></div>
        <ul id="listaFinal" style="list-style:none; padding:0; margin:0 0 18px 0;"></ul>
        <div class="d-flex justify-content-center gap-3">
          <button id="reiniciar" class="btn-continuar btn-lg">Reiniciar</button>
          <a href="equipes.html" id="botaoEditarEquipes" class="btn btn-outline-pink btn-lg">Editar equipes</a>
        </div>
      </div>
    </div>
  </div>
  
  <script>
    // Pontuação: base 1 ponto imediato para resposta correta.
    // Se justificar corretamente, ganha os pontos extras (peso - 1).
    // Se desafiante for validado, ganha apenas os pontos extras (peso - 1);
    // se o time original já tinha recebido o ponto base, esse ponto é removido.
    // substitua a inicialização de 'equipes' por carregar do localStorage (ou usar default)
    let equipes = [
      { nome: "Equipe 1", pontos: 0 },
      { nome: "Equipe 2", pontos: 0 }
    ];

    function salvarEquipes() {
      localStorage.setItem('equipes', JSON.stringify(equipes));
    }

    function carregarEquipes() {
      const s = localStorage.getItem('equipes');
      if (s) equipes = JSON.parse(s);
    }

    carregarEquipes(); // carrega placar salvo ao iniciar

    let equipeIndex = 0;
    let indicePergunta = 0;
    let desafioChallenger = null;
    let basePointGiven = false;
    let basePointOwner = null;
    let currentResponder = 0;

    const perguntas = [
      // Peso 3 (par 1)
      { texto: "O vírus HIV é transmitido somente através de relações sexuais desprotegidas (peso 3)", resposta: false, peso: 3 },
      { texto: "O HPV infecta apenas a pele da região genital (peso 3)", resposta: false, peso: 3 },

      // Peso 4 (par 1)
      { texto: "As ISTs que causam úlceras ou inflamação genital podem facilitar a transmissão e a aquisição do HIV (peso 4)", resposta: true, peso: 4 },
      { texto: "A sífilis não tratada pode evoluir para a Neurossífilis, afetando o sistema nervoso e causando danos cerebrais ou na medula espinhal (peso 4)", resposta: true, peso: 4 },

      // Peso 5 (par 1)
      { texto: "O uso consistente de preservativos elimina completamente o risco de contrair qualquer IST (peso 5)", resposta: false, peso: 5 },
      { texto: "O consentimento é um acordo 'sim ou não' que é dado no início da relação sexual e vale para todo o ato, não podendo ser retirado depois de iniciado (peso 5)", resposta: false, peso: 5 },

      // Peso 3 (par 2)
      { texto: "O cancro mole e a sífilis primária são facilmente diferenciados porque o cancro da sífilis (duro) é indolor, e o cancro mole é doloroso (peso 3)", resposta: true, peso: 3 },
      { texto: "O uso de lubrificantes à base de óleo, como vaselina ou óleos corporais, é recomendado em conjunto com preservativos de látex para evitar o atrito e o rompimento (peso 3)", resposta: false, peso: 3 },

      // Peso 4 (par 2)
      { texto: "A clamídia é frequentemente assintomática, especialmente em mulheres, sendo essa a principal razão para a sua rápida disseminação e a progressão para complicações (peso 4)", resposta: true, peso: 4 },
      { texto: "É comum que a Gonorreia e a Clamídia ocorram como coinfecção, exigindo tratamento para ambas as bactérias simultaneamente (peso 4)", resposta: true, peso: 4 },

      // Peso 5 (par 2)
      { texto: "Uma pessoa com HIV que está em tratamento antirretroviral e tem a carga viral indetectável ainda pode transmitir o vírus sexualmente (peso 5)", resposta: false, peso: 5 },
      { texto: "A vacinação contra o HPV deve ser realizada após o início da atividade sexual para garantir que o organismo possa criar anticorpos contra o vírus (peso 5)", resposta: false, peso: 5 }
    ];

    const nomeEquipeAtualEl = document.getElementById("nomeEquipeAtual");
    const placarTextEl = document.getElementById("placarText");
    const perguntaTextoEl = document.getElementById("perguntaTexto");
    const pesoPerguntaEl = document.getElementById("pesoPergunta");
    const btnVerdadeiro = document.getElementById("btnVerdadeiro");
    const btnFalso = document.getElementById("btnFalso");
    const feedbackEl = document.getElementById("feedback");
    const resultadoRespostaEl = document.getElementById("resultadoResposta");
    const areaJustificativa = document.getElementById("areaJustificativa");
    const areaDesafio = document.getElementById("area-desafio");
    const nomeAdversariaEl = document.getElementById("nomeAdversaria");
    const justificativaSim = document.getElementById("justificativaSim");
    const justificativaNao = document.getElementById("justificativaNao");
    const desafioSim = document.getElementById("desafioSim");
    const desafioNao = document.getElementById("desafioNao");
    const controlesModerador = document.getElementById("controlesModerador");
    const justOk = document.getElementById("justOk");
    const justBad = document.getElementById("justBad");
    const proximaBtn = document.getElementById("proxima");
    const placarFinal = document.getElementById("placarFinal");
    const listaFinal = document.getElementById("listaFinal");
    const reiniciarBtn = document.getElementById("reiniciar");

    function atualizarPlacarDOM() {
      placarTextEl.textContent = `${equipes[0].nome}: ${equipes[0].pontos} — ${equipes[1].nome}: ${equipes[1].pontos}`;
    }

    function atualizarEquipeAtualDOM() {
      nomeEquipeAtualEl.textContent = equipes[equipeIndex].nome;
    }

    function mostrarPergunta() {
      // define claramente quem responde esta pergunta antes de qualquer alteração de índices
      currentResponder = equipeIndex;
      // reset estado específico da pergunta
      basePointGiven = false;
      basePointOwner = null;
      desafioChallenger = null;
  
      atualizarEquipeAtualDOM();
      atualizarPlacarDOM();
      feedbackEl.style.display = "none";
      areaJustificativa.style.display = "none";
      areaDesafio.style.display = "none";
      controlesModerador.style.display = "none";
      proximaBtn.style.display = "none";
      btnVerdadeiro.disabled = false;
      btnFalso.disabled = false;
  
  if (indicePergunta >= perguntas.length) {
  // Fim do jogo → salva pontuação e redireciona para tela final
  salvarEquipes();
  window.location.href = "resultado.html";
  return;
}

      perguntaTextoEl.textContent = perguntas[indicePergunta].texto;
      pesoPerguntaEl.textContent = perguntas[indicePergunta].peso;
      document.querySelector(".botoes").style.display = "block";
    }

    function handleResposta(chute) {
      btnVerdadeiro.disabled = true;
      btnFalso.disabled = true;
      const peso = perguntas[indicePergunta].peso || 1;
      const acertou = chute === perguntas[indicePergunta].resposta;
      resultadoRespostaEl.textContent = acertou ? "Acertou!" : "Errou!";
      feedbackEl.style.display = "block";

      if (acertou) {
        if (!basePointGiven) {
          equipes[currentResponder].pontos += 1;
          basePointGiven = true;
          basePointOwner = currentResponder;
          atualizarPlacarDOM();
          salvarEquipes(); // grava ponto base
        }
        // pergunta ao professor se justificou certo (para ganhar o restante)
        areaJustificativa.style.display = "block";
        areaJustificativa.dataset.acertou = "1";
      } else {
        // time errou -> pergunta imediatamente se a equipe adversária quer desafiar
        areaJustificativa.style.display = "none";
        areaJustificativa.dataset.acertou = "0";
        nomeAdversariaEl.textContent = equipes[1 - currentResponder].nome;
        areaDesafio.style.display = "block";
      }
    }

    // professor: justificativa do time atual está correta -> concede os pontos extras
    justificativaSim.addEventListener('click', function() {
      const peso = perguntas[indicePergunta].peso || 1;
      const extra = Math.max(0, peso - 1);
      if (extra > 0) {
        equipes[currentResponder].pontos += extra;
      }
      atualizarPlacarDOM();
      salvarEquipes(); // grava soma final (base + extras)
      areaJustificativa.style.display = "none";
      feedbackEl.style.display = "none";
      indicePergunta++;
      proximaEquipe();
      mostrarPergunta();
    });

    // professor: justificativa incorreta -> mantém 1 ponto base (se já dado) e abre possibilidade de desafio
    justificativaNao.addEventListener('click', function() {
      // se o base point ainda não foi dado (teoricamente não acontece aqui), não dá nada
      nomeAdversariaEl.textContent = equipes[1 - currentResponder].nome;
      areaJustificativa.style.display = "none";
      areaDesafio.style.display = "block";
      // basePointGiven/basePointOwner permanecem como estão
    });

    // adversária decide desafiar -> mostra controles do moderador para validar justificativa do desafiante
    desafioSim.addEventListener('click', function() {
      areaDesafio.style.display = "none";
      controlesModerador.style.display = "block";
      desafioChallenger = 1 - currentResponder;
    });

    // adversária não desafia -> segue para próxima (currentResponder já ficou com seu ponto base se tinha)
    desafioNao.addEventListener('click', function() {
      areaDesafio.style.display = "none";
      feedbackEl.style.display = "none";
      indicePergunta++;
      proximaEquipe();
      mostrarPergunta();
    });

    // moderador: justificativa do desafiante correta -> desafiante ganha somente os pontos extras
    justOk.addEventListener('click', function() {
      if (desafioChallenger === null) return;
      const peso = perguntas[indicePergunta].peso || 1;
      const extra = Math.max(0, peso - 1);

      // NÃO remover mais o ponto base do respondente original — mantém pontos já computados
      // desafiante ganha apenas os pontos extras
      if (extra > 0) {
        equipes[desafioChallenger].pontos += extra;
      }
      atualizarPlacarDOM();
      salvarEquipes(); // grava alterações após desafio
      controlesModerador.style.display = "none";
      feedbackEl.style.display = "none";
      indicePergunta++;
      proximaEquipe();
      mostrarPergunta();
    });

    // moderador: justificativa do desafiante incorreta -> segue sem mudanças (original mantém base se tinha)
    justBad.addEventListener('click', function() {
      controlesModerador.style.display = "none";
      feedbackEl.style.display = "none";
      indicePergunta++;
      proximaEquipe();
      mostrarPergunta();
    });

    proximaBtn.addEventListener('click', function() {
      indicePergunta++;
      proximaEquipe();
      mostrarPergunta();
    });

    reiniciarBtn.addEventListener('click', function() {
      location.reload();
    });

    btnVerdadeiro.addEventListener('click', function() { handleResposta(true); });
    btnFalso.addEventListener('click', function() { handleResposta(false); });

    function proximaEquipe() {
      equipeIndex = 1 - equipeIndex;
    }

    // inicializa
    mostrarPergunta();
  </script>
</body>
</html>
